# TODO — Auth/Reset Flow

- Миграции: привести схему к текущей модели (`user_tokens.token_hash`, `users.token_version`) через новую Flyway-версию; убедиться, что старый столбец `token` больше не используется, индексы обновлены.
- Secrets/dev-коды: убрать дефолтные значения для JWT/OTP/reset, включить `require-env-secret` вне локалки и требовать передавать коды через окружение; по умолчанию dev-коды должны быть пустыми.
- OTP логин: не выдавать/не регистрировать refresh сессии до подтверждения OTP; чистить незавершённые OTP-попытки/лишние сессии, чтобы не вычищались валидные refresh токены.
- Email verification: отправка письма при регистрации/запросе, понятный ответ 400/404 при невалидном токене, минимальный UI (ввод кода/клик по ссылке); продумать, нужно ли требовать `email_verified` для входа/чувствительных действий.
- Rate limits/cooldown: включить ненулевой лимит на `/api/auth/login` по email, задействовать `resetCooldown` на `/forgot` (per email/IP), проверить лимиты на OTP-verify.
